<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canlƒ± Deprem Takip</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üåç</text></svg>">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#007bff">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body { margin: 0; padding: 0; font-family: 'Segoe UI', Roboto, sans-serif; }
        #map { height: 100vh; width: 100%; }
        
        /* Bƒ∞LGƒ∞ KUTUSU */
        .bilgi-kutusu {
            position: absolute; top: 20px; right: 20px; z-index: 1000;
            background: rgba(255, 255, 255, 0.95); padding: 15px;
            border-radius: 12px; width: 230px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            border-left: 5px solid #007bff;
        }
        .bilgi-kutusu h2 { margin: 0 0 10px 0; font-size: 16px; color: #333; font-weight: 700; border-bottom: 1px solid #eee; padding-bottom: 5px;}
        .legend-item { display: flex; align-items: center; margin-bottom: 6px; font-size: 13px; font-weight: 500;}
        .dot { height: 12px; width: 12px; border-radius: 50%; display: inline-block; margin-right: 10px; border: 1px solid rgba(0,0,0,0.1);}
        .guncelleme-bilgisi { font-size: 11px; color: #888; margin-top: 10px; text-align: right; font-weight: 600;}
        
        .hata-kutusu { background: #ffebee; color: #c62828; padding: 10px; border-radius: 4px; font-size: 11px; margin-top: 10px; display: none; border: 1px solid #ef9a9a;}

        /* Konum Butonu */
        .konum-butonu {
            position: fixed; bottom: 30px; right: 20px; z-index: 2000;
            background: #007bff; color: white; border: none;
            border-radius: 50%; width: 50px; height: 50px;
            font-size: 20px; cursor: pointer; 
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
            display: flex; align-items: center; justify-content: center;
        }
        
        /* D√ºnya Haritasƒ± Butonu */
        .dunya-butonu {
            position: fixed; bottom: 30px; left: 20px; z-index: 2000;
            background: #2c3e50; color: white; border: none;
            border-radius: 30px; padding: 0 20px; height: 50px;
            font-size: 14px; font-weight: bold; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); 
            display: flex; align-items: center; gap: 10px; 
            text-decoration: none; font-family: sans-serif;
        }

        /* POPUP TASARIMI */
        .leaflet-popup-content-wrapper { border-radius: 12px; padding: 0; overflow: hidden;}
        .leaflet-popup-content { margin: 0; line-height: 1.5; font-size: 13px; }
        .popup-header { background: #e3f2fd; padding: 12px 15px; border-bottom: 1px solid #bbdefb; font-weight: bold; color: #0d47a1; font-size: 15px;}
        .popup-body { padding: 15px; }
        .popup-row { display: flex; align-items: center; margin-bottom: 8px; color: #555; }
        .popup-row i { width: 25px; text-align: center; margin-right: 5px; color: #007bff; font-size: 14px; }
        
        .saat-kutusu {
            background-color: #f8f9fa; border: 1px solid #eee;
            border-radius: 8px; padding: 8px; margin-top: 10px;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
    </style>
</head>
<body>

    <div id="map"></div>
    <button class="konum-butonu" id="konumBtn" onclick="konumBul()"><i class="fa-solid fa-location-crosshairs"></i></button>
    <a href="dunya.html" class="dunya-butonu">üåç D√ºnya Haritasƒ±</a>

    <div class="bilgi-kutusu">
        <h2>Canlƒ± Deprem Takip</h2>
        <div class="legend-item"><span class="dot" style="background:#e74c3c;"></span> 4.0 ve √úzeri (Riskli)</div>
        <div class="legend-item"><span class="dot" style="background:#f39c12;"></span> 3.0 - 4.0 Arasƒ±</div>
        <div class="legend-item"><span class="dot" style="background:#2ecc71;"></span> 3.0 Altƒ± (Ufak)</div>
        <div class="guncelleme-bilgisi" id="zaman-damgasi">Konumlar Hesaplanƒ±yor...</div>
        <div class="hata-kutusu" id="hata-alani"></div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        var map = L.map('map', {zoomControl: false}).setView([39.0, 35.0], 6);
        L.control.zoom({ position: 'topleft' }).addTo(map);

        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
            attribution: '¬© OpenStreetMap contributors ¬© EMSC', maxZoom: 19
        }).addTo(map);

        var depremKatmani = L.layerGroup().addTo(map);
        var konumKatmani = L.layerGroup().addTo(map);

        // --- 81 ƒ∞Lƒ∞N KOORDƒ∞NATLARI (≈ûEHƒ∞R BULMAK ƒ∞√áƒ∞N) ---
        const iller = [
            {ad: "ADANA", lat: 37.00, lng: 35.32}, {ad: "ADIYAMAN", lat: 37.76, lng: 38.27}, {ad: "AFYON", lat: 38.75, lng: 30.54},
            {ad: "AƒûRI", lat: 39.72, lng: 43.05}, {ad: "AMASYA", lat: 40.65, lng: 35.83}, {ad: "ANKARA", lat: 39.92, lng: 32.86},
            {ad: "ANTALYA", lat: 36.88, lng: 30.70}, {ad: "ARTVƒ∞N", lat: 41.18, lng: 41.82}, {ad: "AYDIN", lat: 37.84, lng: 27.84},
            {ad: "BALIKESƒ∞R", lat: 39.65, lng: 27.88}, {ad: "Bƒ∞LECƒ∞K", lat: 40.15, lng: 29.98}, {ad: "Bƒ∞NG√ñL", lat: 38.88, lng: 40.49},
            {ad: "Bƒ∞TLƒ∞S", lat: 38.40, lng: 42.10}, {ad: "BOLU", lat: 40.73, lng: 31.60}, {ad: "BURDUR", lat: 37.72, lng: 30.29},
            {ad: "BURSA", lat: 40.19, lng: 29.06}, {ad: "√áANAKKALE", lat: 40.14, lng: 26.40}, {ad: "√áANKIRI", lat: 40.60, lng: 33.62},
            {ad: "√áORUM", lat: 40.54, lng: 34.95}, {ad: "DENƒ∞ZLƒ∞", lat: 37.78, lng: 29.09}, {ad: "Dƒ∞YARBAKIR", lat: 37.91, lng: 40.24},
            {ad: "EDƒ∞RNE", lat: 41.67, lng: 26.55}, {ad: "ELAZIƒû", lat: 38.68, lng: 39.22}, {ad: "ERZƒ∞NCAN", lat: 39.75, lng: 39.49},
            {ad: "ERZURUM", lat: 39.90, lng: 41.27}, {ad: "ESKƒ∞≈ûEHƒ∞R", lat: 39.76, lng: 30.52}, {ad: "GAZƒ∞ANTEP", lat: 37.06, lng: 37.38},
            {ad: "Gƒ∞RESUN", lat: 40.91, lng: 38.39}, {ad: "G√úM√ú≈ûHANE", lat: 40.46, lng: 39.48}, {ad: "HAKKARƒ∞", lat: 37.57, lng: 43.74},
            {ad: "HATAY", lat: 36.20, lng: 36.16}, {ad: "ISPARTA", lat: 37.76, lng: 30.55}, {ad: "MERSƒ∞N", lat: 36.81, lng: 34.64},
            {ad: "ƒ∞STANBUL", lat: 41.01, lng: 28.97}, {ad: "ƒ∞ZMƒ∞R", lat: 38.42, lng: 27.14}, {ad: "KARS", lat: 40.60, lng: 43.09},
            {ad: "KASTAMONU", lat: 41.37, lng: 33.77}, {ad: "KAYSERƒ∞", lat: 38.72, lng: 35.48}, {ad: "KIRKLARELƒ∞", lat: 41.73, lng: 27.22},
            {ad: "KIR≈ûEHƒ∞R", lat: 39.14, lng: 34.16}, {ad: "KOCAELƒ∞", lat: 40.85, lng: 29.88}, {ad: "KONYA", lat: 37.87, lng: 32.48},
            {ad: "K√úTAHYA", lat: 39.42, lng: 29.98}, {ad: "MALATYA", lat: 38.35, lng: 38.31}, {ad: "MANƒ∞SA", lat: 38.61, lng: 27.42},
            {ad: "KAHRAMANMARA≈û", lat: 37.57, lng: 36.93}, {ad: "MARDƒ∞N", lat: 37.31, lng: 40.74}, {ad: "MUƒûLA", lat: 37.21, lng: 28.36},
            {ad: "MU≈û", lat: 38.73, lng: 41.49}, {ad: "NEV≈ûEHƒ∞R", lat: 38.62, lng: 34.71}, {ad: "Nƒ∞ƒûDE", lat: 37.96, lng: 34.68},
            {ad: "ORDU", lat: 40.98, lng: 37.88}, {ad: "Rƒ∞ZE", lat: 41.02, lng: 40.51}, {ad: "SAKARYA", lat: 40.77, lng: 30.39},
            {ad: "SAMSUN", lat: 41.27, lng: 36.33}, {ad: "Sƒ∞ƒ∞RT", lat: 37.93, lng: 41.94}, {ad: "Sƒ∞NOP", lat: 42.02, lng: 35.15},
            {ad: "Sƒ∞VAS", lat: 39.75, lng: 37.01}, {ad: "TEKƒ∞RDAƒû", lat: 40.97, lng: 27.51}, {ad: "TOKAT", lat: 40.32, lng: 36.55},
            {ad: "TRABZON", lat: 41.00, lng: 39.72}, {ad: "TUNCELƒ∞", lat: 39.10, lng: 39.54}, {ad: "≈ûANLIURFA", lat: 37.16, lng: 38.79},
            {ad: "U≈ûAK", lat: 38.68, lng: 29.40}, {ad: "VAN", lat: 38.50, lng: 43.37}, {ad: "YOZGAT", lat: 39.82, lng: 34.80},
            {ad: "ZONGULDAK", lat: 41.45, lng: 31.79}, {ad: "AKSARAY", lat: 38.37, lng: 34.02}, {ad: "BAYBURT", lat: 40.26, lng: 40.22},
            {ad: "KARAMAN", lat: 37.18, lng: 33.22}, {ad: "KIRIKKALE", lat: 39.84, lng: 33.51}, {ad: "BATMAN", lat: 37.88, lng: 41.13},
            {ad: "≈ûIRNAK", lat: 37.52, lng: 42.46}, {ad: "BARTIN", lat: 41.63, lng: 32.33}, {ad: "ARDAHAN", lat: 41.11, lng: 42.70},
            {ad: "IƒûDIR", lat: 39.92, lng: 44.04}, {ad: "YALOVA", lat: 40.65, lng: 29.27}, {ad: "KARAB√úK", lat: 41.20, lng: 32.62},
            {ad: "Kƒ∞Lƒ∞S", lat: 36.71, lng: 37.11}, {ad: "OSMANƒ∞YE", lat: 37.07, lng: 36.25}, {ad: "D√úZCE", lat: 40.84, lng: 31.15}
        ];

        // EN YAKIN ≈ûEHRƒ∞ BULAN FONKSƒ∞YON
        function enYakinSehriBul(lat, lng) {
            let enYakin = "Bilinmiyor";
            let enKisaMesafe = 99999;

            iller.forEach(il => {
                // Basit Pisagor Teoremi ile mesafe hesabƒ± (Yeterli hassasiyet)
                let mesafe = Math.sqrt(Math.pow(il.lat - lat, 2) + Math.pow(il.lng - lng, 2));
                if (mesafe < enKisaMesafe) {
                    enKisaMesafe = mesafe;
                    enYakin = il.ad;
                }
            });
            return enYakin;
        }

        function verileriGetir() {
            const durum = document.getElementById('zaman-damgasi');
            const hataAlani = document.getElementById('hata-alani');
            durum.innerText = "Veri √áekiliyor...";
            hataAlani.style.display = 'none';

            // EMSC (Avrupa Sismoloji Merkezi) - √áember Arama Modu
            const url = 'https://www.seismicportal.eu/fdsnws/event/1/query?format=geojson&limit=100&lat=39.0&lon=35.0&maxradius=12&minmag=2.0';

            fetch(url)
                .then(response => {
                    if (!response.ok) throw new Error("Sunucu yanƒ±t vermedi");
                    return response.json();
                })
                .then(data => {
                    depremKatmani.clearLayers();
                    const depremler = data.features;
                    
                    if(!depremler || depremler.length === 0) {
                        durum.innerText = "Liste bo≈ü.";
                        return;
                    }

                    depremler.forEach(feature => {
                        const lng = feature.geometry.coordinates[0];
                        const lat = feature.geometry.coordinates[1];
                        const depth = feature.geometry.coordinates[2];
                        const mag =
